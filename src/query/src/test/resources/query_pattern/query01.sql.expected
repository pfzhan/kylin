SELECT COUNT(DISTINCT "O_YEAR") "DISTINCT_O_YEAR", (("PERU_VOLUMN" / "VOLUME") + SQRT(4)) "MKT_SHARE"
FROM (SELECT (YEAR("O_ORDERDATE")) "O_YEAR", (("L_EXTENDEDPRICE" * (1 - "L_DISCOUNT")) + 2) "VOLUME", (CASE WHEN ("N2"."N_NAME" = 'PERU') THEN ("L_EXTENDEDPRICE" * (1 - "L_DISCOUNT")) ELSE 0 END) "PERU_VOLUMN"
FROM "TPCH"."LINEITEM"
INNER JOIN "TPCH"."PART" ON ("L_PARTKEY" = "P_PARTKEY")
INNER JOIN "TPCH"."SUPPLIER" ON ("L_SUPPKEY" = "S_SUPPKEY")
INNER JOIN "TPCH"."ORDERS" ON ("L_ORDERKEY" = "O_ORDERKEY")
INNER JOIN "TPCH"."CUSTOMER" ON ("O_CUSTKEY" = "C_CUSTKEY")
INNER JOIN "TPCH"."NATION" "N1" ON ("C_NATIONKEY" = "N1"."N_NATIONKEY")
INNER JOIN "TPCH"."NATION" "N2" ON ("S_NATIONKEY" = "N2"."N_NATIONKEY")
INNER JOIN "TPCH"."REGION" ON ("N1"."N_REGIONKEY" = "R_REGIONKEY")
WHERE ((("R_NAME" = 'A') AND ("O_ORDERDATE" BETWEEN '2010-01-01' AND '2010-01-01')) AND ("P_TYPE" = 'A'))) "ALL_NATIONS"
GROUP BY (("PERU_VOLUMN" / "VOLUME") + SQRT(4))
ORDER BY (("PERU_VOLUMN" / "VOLUME") + SQRT(4))